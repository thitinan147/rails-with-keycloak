Rails with Keycloak (Without Using Gem)
‚öôÔ∏è ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Ruby on Rails ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Keycloak ‡πÇ‡∏î‡∏¢ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Gem ‡πÄ‡∏™‡∏£‡∏¥‡∏°
üìå ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Keycloak ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÅ‡∏ö‡∏ö manual ‡∏û‡∏£‡πâ‡∏≠‡∏° TDD ‡∏ö‡∏ô branch main

üì¶ Clone ‡πÅ‡∏•‡∏∞ Setup ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå
bash
Copy
Edit
git clone https://github.com/thitinan147/rails-with-keycloak.git
cd rails-with-keycloak
git switch login-with-keycloak-without-using-gem
docker-compose up
‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î CTRL+C ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ docker-compose down ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î container

üîê ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Keycloak
‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Keycloak ‡∏ó‡∏µ‡πà http://localhost:8080

‚û§ ‡∏™‡∏£‡πâ‡∏≤‡∏á Realm
‡πÑ‡∏õ‡∏ó‡∏µ‡πà Manage Realms ‚Üí Create Realm

‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ Realm (‡πÄ‡∏ä‡πà‡∏ô myrealm)


‚û§ ‡∏™‡∏£‡πâ‡∏≤‡∏á Client
‡πÑ‡∏õ‡∏ó‡∏µ‡πà Clients ‚Üí Create Client

‡πÄ‡∏õ‡∏¥‡∏î Client authentication ‡πÅ‡∏•‡∏∞ Authorization

‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:

Field	Value
Client ID	myclient (‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
Root URL	http://localhost:3000
Valid Redirect URIs	http://localhost:3000/auth/callback





‚û§ ‡∏™‡∏£‡πâ‡∏≤‡∏á User
‡πÑ‡∏õ‡∏ó‡∏µ‡πà Users ‚Üí Add User

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö Credentials ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô




üõ† ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå
1. ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô Editor
app/controllers/sessions_controller.rb

app/services/keycloak_service.rb

‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ö‡∏ô macOS:

Cmd + P : ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå

Cmd + F : ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå

2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ
‡πÉ‡∏ô sessions_controller.rb ‡πÅ‡∏•‡∏∞ keycloak_service.rb
‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ	‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà
myrealm	‡∏ä‡∏∑‡πà‡∏≠ Realm ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
myclient	‡∏ä‡∏∑‡πà‡∏≠ Client ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
client_secret	‡∏î‡∏π‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Keycloak Admin Console

üîë ‡∏î‡∏π client_secret ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Client ‚Üí Credentials


üöÄ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login
‡πÄ‡∏õ‡∏¥‡∏î http://localhost:3000

‡∏Å‡∏î Login ‚Üí ‡∏Å‡∏£‡∏≠‡∏Å username & password ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ

‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏•‡∏±‡∏á login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à


‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î Logout ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥

üéì ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠
‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡∏∞‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Keycloak ‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ gem ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÉ‡∏î ‡πÜ

üß™ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Branch
main ‚Üí ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô TDD

login-with-keycloak-without-using-gem ‚Üí ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Keycloak ‡πÅ‡∏ö‡∏ö manual

# üöÄ Rails + Keycloak Authentication (No Gem)

‡∏£‡∏∞‡∏ö‡∏ö TDD ‡πÅ‡∏¢‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà branch: `main`  
Branch ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: `login-with-keycloak-without-using-gem`

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Keycloak ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Login ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ gem ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÉ‡∏î‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Rails ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢

---

## üì¶ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

### 1. Clone Repository
```bash
git clone https://github.com/thitinan147/rails-with-keycloak.git
cd rails-with-keycloak
2. ‡∏™‡∏•‡∏±‡∏ö Branch
bash
Copy
Edit
git switch login-with-keycloak-without-using-gem
3. ‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Docker
bash
Copy
Edit
docker-compose up
# ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î:
# docker-compose down
‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Keycloak
‡πÄ‡∏õ‡∏¥‡∏î http://localhost:8080 ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:

üî∏ ‡∏™‡∏£‡πâ‡∏≤‡∏á Realm
‡πÄ‡∏Ç‡πâ‡∏≤ "Manage Realm" ‚Üí Create Realm

‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô: myrealm)



üî∏ ‡∏™‡∏£‡πâ‡∏≤‡∏á Client
‡πÑ‡∏õ‡∏ó‡∏µ‡πà "Clients" ‚Üí Create Client

‡πÄ‡∏õ‡∏¥‡∏î Client Authentication ‡πÅ‡∏•‡∏∞ Authorization



‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:

Root URL: http://localhost:3000

Valid Post Logout Redirect URIs: http://localhost:3000/auth/callback



üî∏ ‡πÄ‡∏û‡∏¥‡πà‡∏° User
‡πÑ‡∏õ‡∏ó‡∏µ‡πà "Users" ‚Üí Add User

‡∏ï‡∏±‡πâ‡∏á Username ‡πÅ‡∏•‡∏∞ Email ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£



‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà "Credentials" ‚Üí ‡∏ï‡∏±‡πâ‡∏á Password ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î "Temporary" ‡πÄ‡∏õ‡πá‡∏ô Off



‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Code ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Realm/Client ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
‡πÉ‡∏ä‡πâ VS Code ‡∏´‡∏£‡∏∑‡∏≠ Editor ‡∏≠‡∏∑‡πà‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á:

üîπ sessions_controller.rb
‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠ Realm ‡πÅ‡∏•‡∏∞ Client ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ

ruby
Copy
Edit
# ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å:
realm = 'myrealm'
client_id = 'myclient'


üîπ keycloak_service.rb
‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠ Realm, Client ‡πÅ‡∏•‡∏∞ client_secret ‡∏ï‡∏≤‡∏° Keycloak ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

ruby
Copy
Edit
# ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
realm = 'myrealm'
client_id = 'myclient'
client_secret = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'


‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏≤ client secret ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Keycloak ‚Üí Client ‚Üí Credentials



üîê ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
‚û§ Login
‡πÄ‡∏õ‡∏¥‡∏î http://localhost:3000

‡∏Ñ‡∏•‡∏¥‡∏Å Login ‚Üí ‡∏Å‡∏£‡∏≠‡∏Å username/password ‡∏à‡∏≤‡∏Å Keycloak



‚úÖ Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ô‡∏µ‡πâ:



üîÅ Logout
‡∏Å‡∏î Logout ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö

üìö ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
‡∏≠‡∏¢‡∏≤‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Keycloak ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÑ‡∏•‡πà‡∏î‡∏π‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

‡πÑ‡∏°‡πà‡∏°‡∏µ gem ‡πÅ‡∏ù‡∏á ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ OAuth2 ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ú‡πà‡∏≤‡∏ô Keycloak

üß™ TDD
‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Test ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà branch: main

‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ üôè
‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Fork ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
